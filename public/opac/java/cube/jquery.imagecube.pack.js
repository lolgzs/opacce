(function(c){function x(){this._defaults={direction:"random",randomSelection:["up","down","left","right"],speed:2E3,easing:"linear",repeat:!0,pause:2E3,selection:"forward",shading:!0,opacity:0.8,imagePath:"",full3D:!0,segments:20,reduction:30,expansion:10,lineHeight:[0,1.25],letterSpacing:[-0.4,0],beforeRotate:null,afterRotate:null}}function A(a,b){c.extend(a,b);for(var d in b)null==b[d]&&(a[d]=null);return a}c.extend(x.prototype,{markerClassName:"hasImageCube",setDefaults:function(a){A(this._defaults,
a||{})},_attachImageCube:function(a,b){a=c(a);if(!a.hasClass(this.markerClassName)){var d=c.extend({_position:a.css("position")},this._defaults,b||{});c.data(a[0],"imageCube",d);a.addClass(this.markerClassName).css({position:"relative"}).children().each(function(){var b=c(this);c.data(this,"imageCube",{display:b.css("display"),width:b.css("width"),height:b.css("height"),position:b.css("position"),lineHeight:b.css("lineHeight"),letterSpacing:b.css("letterSpacing")});b.css({display:"block",width:a.css("width"),
height:a.css("height"),position:"absolute",lineHeight:d.lineHeight[1],letterSpacing:d.letterSpacing[1]})}).not(":first").hide();this._prepareRotation(a[0])}},_prepareRotation:function(a){a=c(a);a.children(".imageCubeShading,.imageCubeFrom,.imageCubeTo").remove();var b=c.data(a[0],"imageCube");b.current=a.children(":visible")[0];var d;"random"==b.selection?(d=a.children(":hidden"),d=!d.length?d:d.filter(":eq("+Math.floor(Math.random()*d.length)+")")):d="backward"==b.selection?c(b.current).prev():c(b.current).next();
b.next=d;b.next=(b.next.length?b.next:"random"==b.selection?b.current:"backward"==b.selection?a.children(":last"):a.children(":first"))[0];b.repeat&&!b._timer&&(b._timer=setTimeout(function(){c.imagecube._rotateImageCube(a[0])},b.pause));c.data(a[0],"imageCube",b)},_rotateImageCube:function(a,b,d){"function"==typeof b&&(d=b,b="");a=c(a);this._stopImageCube(a[0],!0);var e=c.data(a[0],"imageCube");null!=b&&(b="number"==typeof b?a.children(":eq("+b+")"):c(b),0<a.children().filter(function(){return this===
b[0]}).length&&(e.next=b));var f=[e.current,e.next];e.beforeRotate&&e.beforeRotate.apply(a[0],f);a.attr("imageCube",0).stop(!0,!0).animate({imageCube:1},e.speed,e.easing,function(){e.afterRotate&&e.afterRotate.apply(a[0],f);d&&d.apply(a[0])})},_currentImageCube:function(a){return c(a).hasClass(this.markerClassName)?c.data(a,"imageCube").current:null},_nextImageCube:function(a){return c(a).hasClass(this.markerClassName)?c.data(a,"imageCube").next:null},_stopImageCube:function(a,b){var d=c.data(a,"imageCube");
d._timer&&(clearTimeout(d._timer),d._timer=null);b||(d.repeat=!1);c.data(a,"imageCube",d)},_startImageCube:function(a){this._changeImageCube(a,{repeat:!0})},_changeImageCube:function(a,b,d){if("string"==typeof b){var e={};e[b]=d;b=e}d=c.data(a,"imageCube");A(d||{},b||{});c.data(a,"imageCube",d);this._prepareRotation(a)},_destroyImageCube:function(a){a=c(a);if(a.hasClass(this.markerClassName)){this._stopImageCube(a[0]);var b=c.data(a[0],"imageCube");a.stop().css({position:b._position}).removeClass(this.markerClassName).children(".imageCubeShading,.imageCubeFrom,.imageCubeTo").remove();
a.children().each(function(){c(this).css(c.data(this,"imageCube"));c.removeData(this,"imageCube")});c.removeData(a[0],"imageCube")}},_prepareAnimation:function(a){var b=c.data(a,"imageCube"),a=c(a),d=0,e=0;a.parents().each(function(){var a=c(this);if("fixed"==a.css("position"))return d-=a.offset().left,e-=a.offset().top,!1});var f=a.width(),m=a.height(),p="random"!=b.direction?b.direction:b.randomSelection[Math.floor(Math.random()*b.randomSelection.length)],p=Math.max(0,c.inArray(p,["up","down","left",
"right"]));b._curDirection=p;var g=0==p||1==p,h=2==p||3==p,l=0==p||2==p,q=l?0:b.opacity,j=c(b.current),k=c(b.next),i=[],r=function(a){var b=[0,0,0,0];if(!c.browser.msie||a.css("border"))for(var d=0;4>d;d++){b[d]=a.css("border"+["Left","Right","Top","Bottom"][d]+"Width");var e=c.browser.msie?1:0;b[d]=parseFloat({thin:1+e,medium:3+e,thick:5+e}[b[d]]||b[d])}return b};i[0]=r(j);i[1]=r(k);var n=[];n[0]=[parseFloat(j.css("padding-left")),parseFloat(j.css("padding-right")),parseFloat(j.css("padding-top")),
parseFloat(j.css("padding-bottom"))];n[1]=[parseFloat(k.css("padding-left")),parseFloat(k.css("padding-right")),parseFloat(k.css("padding-top")),parseFloat(k.css("padding-bottom"))];var u=[];u[0]=[c.boxModel?i[0][0]+i[0][1]+n[0][0]+n[0][1]:0,c.boxModel?i[0][2]+i[0][3]+n[0][2]+n[0][3]:0];u[1]=[c.boxModel?i[1][0]+i[1][1]+n[1][0]+n[1][1]:0,c.boxModel?i[1][2]+i[1][3]+n[1][2]+n[1][3]:0];r=[];r[0]={elem:j[0],props:{left:{start:d,end:d+(3==p?f:0),units:"px"},width:{start:f-u[0][0],end:g?f-u[0][0]:0,units:"px"},
top:{start:e,end:e+(1==p?m:0),units:"px"},height:{start:m-u[0][1],end:g?0:m-u[0][1],units:"px"},paddingLeft:{start:n[0][0],end:h?0:n[0][0],units:"px"},paddingRight:{start:n[0][1],end:h?0:n[0][1],units:"px"},paddingTop:{start:n[0][2],end:g?0:n[0][2],units:"px"},paddingBottom:{start:n[0][3],end:g?0:n[0][3],units:"px"},borderLeftWidth:{start:i[0][0],end:h?0:i[0][0],units:"px"},borderRightWidth:{start:i[0][1],end:h?0:i[0][1],units:"px"},borderTopWidth:{start:i[0][2],end:g?0:i[0][2],units:"px"},borderBottomWidth:{start:i[0][3],
end:g?0:i[0][3],units:"px"},lineHeight:{start:b.lineHeight[1],end:g?b.lineHeight[0]:b.lineHeight[1],units:"em"},letterSpacing:{start:b.letterSpacing[1],end:g?b.letterSpacing[1]:b.letterSpacing[0],units:"em"}}};r[1]={elem:k[0],props:{left:{start:d+(2==p?f:0),end:d,units:"px"},width:{start:g?f-u[1][0]:0,end:f-u[1][0],units:"px"},top:{start:e+(0==p?m:0),end:e,units:"px"},height:{start:g?c.browser.msie?1:0:m-u[1][1],end:m-u[1][1],units:"px"},paddingLeft:{start:h?0:n[1][0],end:n[1][0],units:"px"},paddingRight:{start:h?
0:n[1][1],end:n[1][1],units:"px"},paddingTop:{start:g?0:n[1][2],end:n[1][2],units:"px"},paddingBottom:{start:g?0:n[1][3],end:n[1][3],units:"px"},borderLeftWidth:{start:h?0:i[1][0],end:i[1][0],units:"px"},borderRightWidth:{start:h?0:i[1][1],end:i[1][1],units:"px"},borderTopWidth:{start:g?0:i[1][2],end:i[1][2],units:"px"},borderBottomWidth:{start:g?0:i[1][3],end:i[1][3],units:"px"},lineHeight:{start:g?b.lineHeight[0]:b.lineHeight[1],end:b.lineHeight[1],units:"em"},letterSpacing:{start:g?b.letterSpacing[1]:
b.letterSpacing[0],end:b.letterSpacing[1],units:"em"}}};b.shading&&(p=function(a,b,c){return{left:{start:a.left.start,end:a.left.end,units:"px"},width:{start:a.width.start,end:a.width.end,units:"px"},top:{start:a.top.start,end:a.top.end,units:"px"},height:{start:a.height.start,end:a.height.end,units:"px"},paddingLeft:{start:a.paddingLeft.start+a.borderLeftWidth.start,end:a.paddingLeft.end+a.borderLeftWidth.end,units:"px"},paddingRight:{start:a.paddingRight.start+a.borderRightWidth.start,end:a.paddingRight.end+
a.borderRightWidth.end,units:"px"},paddingTop:{start:a.paddingTop.start+a.borderTopWidth.start,end:a.paddingTop.end+a.borderTopWidth.end,units:"px"},paddingBottom:{start:a.paddingBottom.start+a.borderBottomWidth.start,end:a.paddingBottom.end+a.borderBottomWidth.end,units:"px"},opacity:{start:b,end:c,units:""}}},r[2]={elem:c((c.browser.msie?'<img src="'+b.imagePath+'imageCubeHigh.png"':"<div")+' class="imageCubeShading" style="background-color: white; opacity: '+q+'; z-index: 10; position: absolute;"'+
(c.browser.msie?"/>":"></div>"))[0],props:p(r[l?0:1].props,q,b.opacity-q)},r[3]={elem:c((c.browser.msie?'<img src="'+b.imagePath+'imageCubeShad.png"':"<div")+' class="imageCubeShading" style="background-color: black; opacity: '+(b.opacity-q)+'; z-index: 10; position: absolute;"'+(c.browser.msie?"/>":"></div>"))[0],props:p(r[l?1:0].props,b.opacity-q,q)});if(b.full3D){for(q=0;q<b.segments;q++)a.append(j.clone().addClass("imageCubeFrom").css({display:"block",position:"absolute",overflow:"hidden"})),
b.shading&&a.append(c(r[l?2:3].elem).clone());for(q=0;q<b.segments;q++)a.append(k.clone().addClass("imageCubeTo").css({display:"block",position:"absolute",width:0,overflow:"hidden"})),b.shading&&a.append(c(r[l?3:2].elem).clone());j.hide();k.css({width:f-u[1][0],height:m-u[1][1]})}else f=function(a){return{left:a.left.start+"px",width:a.width.start+"px",top:a.top.start+"px",height:a.height.start+"px",lineHeight:a.lineHeight.start+"em",padding:a.paddingTop.start+"px "+a.paddingRight.start+"px "+a.paddingBottom.start+
"px "+a.paddingLeft.start+"px",borderLeftWidth:a.borderLeftWidth.start+"px",borderRightWidth:a.borderRightWidth.start+"px",borderTopWidth:a.borderTopWidth.start+"px",borderBottomWidth:a.borderBottomWidth.start+"px",letterSpacing:a.letterSpacing.start+"em",overflow:"hidden"}},j.css(f(r[0].props)),k.css(f(r[1].props)).show(),b.shading&&a.append(r[2].elem).append(r[3].elem);for(q=0;q<r.length;q++)for(var I in r[q].props)a=r[q].props[I],a.diff=a.end-a.start;return r},_drawFull3D:function(a,b,d){var e=
c.data(a,"imageCube");if(!e.full3D)return!1;var a=c(a),f=e._curDirection,m=0==f||1==f,p=0==f||2==f,g=a.width(),h=a.height();if(0==g||0==h)return!0;var l=(1-b)*(m?h:g),q=e.segments,j=e.expansion*(1-Math.abs(2*l-(m?h:g))/(m?h:g)),k=e.reduction-e.reduction*l/(m?h:g),i=function(d,f,g,h,i,j,k,l,p,x,t,v){for(var h=[h-f,j-l],j=Math.max(h[0],h[1]),i=[p-g,k-i],k=Math.max(i[0],i[1]),p=m?(h[0]-h[1])/(q-1)/2:j/q,l=m?k/q:(i[0]-i[1])/(q-1)/2,A=t.paddingLeft[v]+t.paddingRight[v]+t.borderLeftWidth[v]+t.borderRightWidth[v],
v=t.paddingTop[v]+t.paddingBottom[v]+t.borderTopWidth[v]+t.borderBottomWidth[v],B=Math.round(f),C=Math.round(g),y=B,z=C,w=0,D=0;D<a[0].childNodes.length;D++){var s=a[0].childNodes[D];if(s.className==d){var E=Math.round(f+(w+1)*p),F=Math.round(g+(w+1)*l),G=h[0]-(m?2*w*p:0),H=i[0]-(m?0:2*w*l);s.style.left=(m?y:f)+"px";s.style.top=(m?g:z)+"px";s.style.width=Math.max(0,G-A)+"px";s.style.height=Math.max(0,H-v)+"px";s.style.letterSpacing=(m?G/j*(e.letterSpacing[1]-e.letterSpacing[0])+e.letterSpacing[0]:
b*t.letterSpacing.diff+t.letterSpacing.start)+t.letterSpacing.units;s.style.lineHeight=(!m?H/k*(e.lineHeight[1]-e.lineHeight[0])+e.lineHeight[0]:b*t.lineHeight.diff+t.lineHeight.start)+t.lineHeight.units;s.style.clip="rect("+(!m?"auto":z-C+"px")+","+(m?"auto":E-B+"px")+","+(!m?"auto":F-C+"px")+","+(m?"auto":y-B+"px")+")";e.shading&&(s=s.nextSibling,s.style.left=y+"px",s.style.top=z+"px",s.style.width=(m?h[0]-2*w*p:E-y)+"px",s.style.height=(m?F-z:i[0]-2*w*l)+"px",s.style.opacity=x,c.browser.msie&&
(s.style.filter="alpha(opacity="+100*x+")"));y=E;z=F;w++}}};i("imageCubeFrom",[k,-j,0,g-l][f],[0,h-l,k,-j][f],[g-k,g+j,l,g][f],[0,h-l,-j,k][f],[g+j,g-k,l,g][f],[l,h,h+j,h-k][f],[-j,k,0,g-l][f],[l,h,h-k,h+j][f],!e.shading?0:(p?b:1-b)*d[2].props.opacity.diff+d[2].props.opacity.start,d[0].props,"start");i("imageCubeTo",[-j,e.reduction-k,l,0][f],[l,0,-j,e.reduction-k][f],[g+j,g-(e.reduction-k),g,g-l][f],[l,0,e.reduction-k,-j][f],[g-(e.reduction-k),g+j,g,g-l][f],[h,h-l,h-(e.reduction-k),h+j][f],[e.reduction-
k,-j,l,0][f],[h,h-l,h+j,h-(e.reduction-k)][f],!e.shading?0:(p?b:1-b)*d[3].props.opacity.diff+d[3].props.opacity.start,d[1].props,"end");return!0}});c.fn.imagecube=function(a){var b=Array.prototype.slice.call(arguments,1);return"current"==a||"next"==a?c.imagecube["_"+a+"ImageCube"].apply(c.imagecube,[this[0]].concat(b)):this.each(function(){"string"==typeof a?c.imagecube["_"+a+"ImageCube"].apply(c.imagecube,[this].concat(b)):c.imagecube._attachImageCube(this,a)})};c.fx.step.imageCube=function(a){if(0==
a.now||!a.stepProps){a.start=0;a.end=1;a.stepProps=c.imagecube._prepareAnimation(a.elem);var b=a.stepProps[0].elem;a.saveCSS={borderLeftWidth:b.style.borderLeftWidth,borderRightWidth:b.style.borderRightWidth,borderTopWidth:b.style.borderTopWidth,borderBottomWidth:b.style.borderBottomWidth,padding:b.style.padding}}if(!c.imagecube._drawFull3D(a.elem,a.pos,a.stepProps))for(b=0;b<a.stepProps.length;b++){var d=a.stepProps[b],e;for(e in d.props){var f=d.props[e];d.elem.style[e]=a.pos*f.diff+f.start+f.units;
c.browser.msie&&"opacity"==e&&(d.elem.style.filter="alpha(opacity="+100*(a.pos*f.diff+f.start)+")")}}1==a.now&&(c(a.stepProps[0].elem).hide().css(a.saveCSS),c(a.stepProps[1].elem).show(),c.imagecube._prepareRotation(a.elem))};c.imagecube=new x})(jQuery);
